/*! gunther 2013-11-16 */
(function(){var a,b,c,d,e,f,g,h,i,j=[].slice,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};if(d={partials:{},addPartial:function(a,b){if(d.partials[a]=b,null!=d.Template.prototype[a])throw new Error('Partial "'+a+'" already exists');return d.Template.prototype[a]=function(){var b;return b=1<=arguments.length?j.call(arguments,0):[],this.partial.apply(this,[a].concat(b))}}},"undefined"!=typeof require&&null!==require?(module.exports=d,h=require("underscore"),a=require("backbone")):(window.Gunther=d,h=window._,a=window.Backbone),typeof h===!1)throw"Underscore.js must be loaded for Gunther to work";d.Helper=function(){function a(){}return a.createHtmlElement=function(a){var b,c,d,e,f,g,i,j;if(g=h.filter(a.split(/(?=\.)|(\[.+\=.+\])|(\:[a-z0-9]+)|(?=#)/),function(a){return null!=a}),!(g.length>=1))throw new Error("Invalid element description "+a);if(e=g[0],!/^[a-zA-Z0-9]+$/.test(e))throw new Error("Invalid tag name "+e);if(c=$(document.createElement(e)),e===a)return c;for(i=0,j=g.length;j>i;i++)if(f=g[i],"#"===f[0])c.attr("id",f.substr(1));else if("."===f[0])d=null!=c.attr("class")?c.attr("class")+" ":"",c.attr("class",d+f.substr(1));else if(":"===f[0])c.prop(f.substr(1),!0);else if("["===f[0]&&(f[f.length=1]="]")){if(b=f.substr(1).substr(0,f.length-2).split("="),2!==b.length)continue;c.attr(b[0],b[1])}return c},a}(),d.IDGenerator=function(){function a(){this.value=0}return a.prototype.generate=function(){return this.value++},a}(),c=function(){function b(a,b,c){var d,e,f,g,h=this;for(this.model=a,this.propertyNames=b,this.valueGenerator=c,null==this.valueGenerator&&"string"==typeof this.propertyNames&&(this.valueGenerator=function(){return h.model.get(h.propertyNames[0])}),this.propertyNames=[].concat(this.propertyNames),g=this.propertyNames,e=0,f=g.length;f>e;e++)d=g[e],this.model.bind("change:"+d,function(){return h.trigger("change",h.getValue())})}return b.prototype.getValue=function(){var a;return a=this.valueGenerator(),a instanceof d.Template?a.render():a},b.prototype.getValueInEl=function(b){var c,e,f,g,h;if(e=this.valueGenerator(),e instanceof d.Template)return e.renderInto(b,this.model);if(e instanceof a.View)return e.setElement(b),e.render();if(b.length>0){for(h=[],f=0,g=b.length;g>f;f++)c=b[f],h.push(c.textContent=e);return h}return b.textContent=e},b}(),h.extend(c.prototype,a.Events),b=function(){function a(){var a,b,c,e=this;a=arguments[0],b=arguments[1],c=3<=arguments.length?j.call(arguments,2):[],this.model=a,this.propertyName=b,this.template=c.pop(),this.args=c,"function"!=typeof this.template||this.template instanceof d.Template||(this.template=new d.Template(this.template)),this.currentValue=this.model.get(this.propertyName),this.model.bind("change:"+this.propertyName,function(a){var b;return b=a.get(e.propertyName),b!==e.currentValue?(e.currentValue=b,e.trigger("change",b)):void 0})}return a.prototype.getValueInEl=function(a){return this.template.renderInto.apply(this.template,[].concat(a,this.model.get(this.propertyName),this.args))},a}(),h.extend(b.prototype,a.Events),e=function(b){function c(){return i=c.__super__.constructor.apply(this,arguments)}return l(c,b),c.remove=function(a){return $(a).remove()},c.defaultEvents={preRemove:function(){return null},postRemove:function(){return null},preInsert:function(){return null},postInsert:function(){return null}},c.generator=new d.IDGenerator,c.naiveSort=function(a,b,c){var d,e,f,g,h;for(e=function(){var b,e,f,g;for(f=a.toArray(),g=[],b=0,e=f.length;e>b;b++)d=f[b],g.push(d[c].detach());return g}(),h=[],f=0,g=e.length;g>f;f++)d=e[f],h.push(b.append(d));return h},c.prototype.initialize=function(b,d){var e=this;return b instanceof a.Collection&&(this.model=b,b={model:b,generator:d}),this.key="_subview-"+c.generator.generate(),this.elementKey="element-"+this.key,this.prepend=null!=b.prepend?b.prepend:!1,this.generator=b.generator,this.events=h.extend(c.defaultEvents,null!=b.events?b.events:{}),this.remove=null!=b.remove?b.remove:c.remove,this.evenClass=null!=b.evenClass?b.evenClass:void 0,this.oddClass=null!=b.oddClass?b.oddClass:void 0,this.renderedItems={},this.model=null!=b.collection?b.collection:this.model,this.model.each(function(a){return e.initItem(a)}),this.model.bind("add",function(a){return e.addItem(a)}),this.model.bind("remove",function(a){return e.removeItem(a)}),this.model.bind("sort",function(){return c.naiveSort(e.model,e.$el,e.elementKey)}),this.model.bind("reset",function(a){var b,c,d;d=e.renderedItems;for(c in d)b=d[c],e.removeItem(b);return a.each(function(a){return e.addItem(a)})})},c.prototype.setElement=function(a){this.$el=a},c.prototype.addItem=function(a){return this.initItem(a),this.renderItem(a)},c.prototype.removeItem=function(b){return null!=b[this.key]?(b[this.key]instanceof a.View?(this.events.preRemove(b[this.key]),b[this.key].remove(),this.events.postRemove()):(this.events.preRemove(b[this.elementKey]),this.remove(b[this.elementKey]),this.events.postRemove()),delete this.renderedItems[b.cid]):void 0},c.prototype.initItem=function(a){return a[this.key]="function"==typeof this.generator?this.generator(a):this.generator},c.prototype.renderItem=function(b){if(b[this.key]instanceof d.Template)b[this.elementKey]=b[this.key].render(b);else{if(!(b[this.key]instanceof a.View))throw new Error("Generator must return either a Gunther.Template or a Backbone.View instance");b[this.key].render(),b[this.elementKey]=b[this.key].el}return this.events.preInsert(b[this.elementKey],this.$el),this.model.indexOf(b)%2===0?b[this.elementKey].addClass(this.evenClass):b[this.elementKey].addClass(this.oddClass),this.prepend?this.$el.prepend(b[this.elementKey]):this.$el.append(b[this.elementKey]),this.events.postInsert(b[this.elementKey],this.$el),this.renderedItems[b.cid]=b},c.prototype.render=function(){var a=this;return this.model.each(function(b){return a.renderItem(b)})},c}(a.View),d.Template=function(){function f(a){this.fn=a}return f.domParsers=[],f.removePartial=function(){return delete d.Template.partials.key},f.elementValue=function(a,b){return null==b&&(b={}),"function"==typeof a?a.apply(b):a},f.generateChildren=function(e,f,g){var h;return h=d.Template.elementValue(f,g),void 0!==h?("object"!=typeof h&&e.append(document.createTextNode(h)),h instanceof c||h instanceof b?(h.getValueInEl(e),h.bind("change",function(){return e.empty(),h.getValueInEl(e)})):h instanceof d.SwitchedView?h.render():h instanceof a.View?(h.setElement(e),h.render()):void 0):void 0},f.prototype.render=function(){var a,b,c,e,f,g,h,i,k;for(a=1<=arguments.length?j.call(arguments,0):[],this.root=$("<div />"),this.current=this.root,this.fn.apply(this,a),c=this.root.contents(),k=d.Template.domParsers,f=0,h=k.length;h>f;f++)for(e=k[f],g=0,i=c.length;i>g;g++)b=c[g],e(b);return c},f.prototype.renderInto=function(){var a,b,c,d,e,f;for(d=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],c=this.render.apply(this,a),e=0,f=c.length;f>e;e++)b=c[e],$(d).append(b);return c},f.prototype.text=function(a){var b,e;return e=document.createTextNode(""),"string"==typeof a?e.nodeValue=a:(b=d.Template.elementValue(a,this),b instanceof c?(e.nodeValue=b.getValue(),b.bind("change",function(a){return e.nodeValue=a})):e.nodeValue=b),this.current.append(e)},f.prototype.boundText=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.text(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},f.prototype.spacedText=function(a){return this.text(" "+a+" ")},f.prototype.element=function(){var a,e,f,g,h;return h=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],e=this.current,f=d.Helper.createHtmlElement(h),this.current=f,g=a[a.length-1],"function"==typeof g?d.Template.generateChildren(f,a.pop(),this):g instanceof c||g instanceof b?d.Template.generateChildren(f,a.pop(),this):"string"==typeof g&&f.append(document.createTextNode(a.pop())),e.append(f),this.current=e,null},f.prototype.boundElement=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.element(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,a,function(){}))},f.prototype.attribute=function(){var a,b,d,e;return d=arguments[0],e=arguments[1],a=3<=arguments.length?j.call(arguments,2):[],b=this.current,e instanceof c?(b.attr(d,e.getValue()),e.bind("change",function(){return b.attr(d,e.getValue())})):b.attr(d,e),null},f.prototype.boundAttribute=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.attribute(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},f.prototype.property=function(){var a,b,d,e;return d=arguments[0],e=arguments[1],a=3<=arguments.length?j.call(arguments,2):[],b=this.current,e instanceof c?(b.prop(d,e.getValue()),e.bind("change",function(){return b.prop(d,e.getValue())})):b.prop(d,e),null},f.prototype.boundProperty=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.property(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},f.prototype.css=function(a,b){var d,e;return a instanceof Object?function(){var c;c=[];for(e in a)b=a[e],c.push(this.css(e,b));return c}.call(this):(d=this.current,b instanceof c?(d.css(a,b.getValue()),b.bind("change",function(b){return d.css(a,b)}),d):(d.css(a,b),null))},f.prototype.boundCss=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.css(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},f.prototype.show=function(a,b,c){var d,e,f,g,h,i,j;for(d=this.current,null==c&&(c=function(a){return a}),f=function(a,b){return b?$(a).show():$(a).hide()},i=[].concat(b),j=[],g=0,h=i.length;h>g;g++)e=i[g],j.push(function(b){return a.on("change:"+b,function(a){return f(d,c(a.get(b)))}),f(d,c(a.get(b)))}(e));return j},f.prototype.hide=function(a,b,c){return null==c&&(c=function(a){return a}),this.show(a,b,function(a){return!c(a)})},f.prototype.toggleClass=function(a,b,c,d){var e,f,g,h,i;for(c=[].concat(c),d instanceof Function||(d=function(a){return a}),e=this.current,f=function(b,c){return $(e).toggleClass(a,d(c))},h=0,i=c.length;i>h;h++)g=c[h],b.on("change:"+g,f),f(b,b.get(g));return null},f.prototype.on=function(a,b){return this.current.bind(a,b)},f.prototype.haltedOn=function(a,b){return this.current.bind(a,function(a){return a.stopPropagation(),a.preventDefault(),b(a)})},f.prototype.append=function(b){return b instanceof a.View?(b.render(),this.current.append(b.el)):this.current.append(b)},f.prototype.subTemplate=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],b.renderInto.apply(b,[this.current].concat(j.call(a)))},f.prototype.partial=function(){var a,b,c;if(b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],null==d.partials[b])throw new Error('Partial "'+b+'" does not exist');return c=new d.Template(d.partials[b]),this.subTemplate.apply(this,[c].concat(a))},f.prototype.bind=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){})},f.prototype.onModel=function(a,b,c){var d;return d=this.current,a.on(b,function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],c.apply(this,[d].concat(a))})},f.prototype.itemSubView=function(a,b){return null==b&&(b=null),new e(a,b)},f.prototype.list=function(a,b,c){return null==c&&(c=null),this.element(a,function(){return new e(b,c)})},f.prototype.e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],this.element.apply(this,[b].concat(j.call(a)))},f.prototype.t=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.text.apply(this,a)},f.prototype.attr=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.attribute.apply(this,a)},f.prototype.a=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.attribute.apply(this,a)},f.prototype.prop=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.property.apply(this,a)},f.prototype["class"]=function(a){return this.attribute("class",a)},f.prototype.p=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.partial.apply(this,a)},f}(),d.Template.prototype.switchView=function(a,b,c,d){return this.element(a,function(){return new f(this.current,b,c,d)})},f=function(){function a(a,b,c,d){var e=this;this.parent=a,this.model=b,this.attributeName=c,this.model.on("change:"+this.attributeName,function(){return e.render()}),d.apply(this,[this.model])}return a.prototype.switches=[],a.prototype.render=function(){var a=this;return null!=this.active&&this.active.makeUnActiveIn(this.parent),this.active=h.find(this.switches,function(b){return b.isActive(a.model.get(a.attributeName))}),this.active.makeActiveIn(this.parent)},a.prototype.keep=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],this.switches.push(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(g,[g.KEEP,b].concat(j.call(a)),function(){}))},a.prototype["switch"]=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],this.switches.push(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(g,[g.SWITCH,b].concat(j.call(a)),function(){}))},a}(),g=function(){function a(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?j.call(arguments,2):[],this.type=c,this.template=b,this.determinator=a.pop(),this.arguments=a}return a.KEEP="keep",a.SWITCH="switch",a.prototype.isActive=!1,a.prototype.isActive=function(a){return this.determinator(a)},a.prototype.makeActiveIn=function(a){return null!=this.switchedElements?this.switchedElements.show():this.switchedElements=this.template.renderInto.apply(this.template,[a].concat(this.arguments))},a.prototype.makeUnActiveIn=function(){return this.type===a.KEEP?this.switchedElements.hide():this.switchedElements.remove()},a}(),d.SwitchedView=f}).call(this);