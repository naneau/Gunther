/*! gunther 2013-07-18 */
!function(){var a,b,c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=[].slice;if(c={},"undefined"!=typeof require&&null!==require?(module.exports=c,e=require("underscore"),a=require("backbone")):(window.Gunther=c,e=window._,a=window.Backbone),typeof e===!1)throw"Underscore.js must be loaded for Gunther to work";c.IDGenerator=function(){function a(){this.value=0}return a.prototype.generate=function(){return this.value++},a}(),b=function(){function b(a,b,c){var d,e,f,g,h=this;for(this.model=a,this.propertyNames=b,this.valueGenerator=c,null==this.valueGenerator&&"string"==typeof this.propertyNames&&(this.valueGenerator=function(){return h.model.get(h.propertyNames[0])}),this.propertyNames=[].concat(this.propertyNames),g=this.propertyNames,e=0,f=g.length;f>e;e++)d=g[e],this.model.bind("change:"+d,function(){return h.trigger("change",h.getValue())})}return b.prototype.getValue=function(){var a;return a=this.valueGenerator(),a instanceof c.Template?a.render():a},b.prototype.getValueInEl=function(b){var d,e,f,g,h;if(e=this.valueGenerator(),e instanceof c.Template)return e.renderInto(b,this.model);if(e instanceof a.View)return e.setElement(b),e.render();if(b.length>0){for(h=[],f=0,g=b.length;g>f;f++)d=b[f],h.push(d.textContent=e);return h}return b.textContent=e},b}(),e.extend(b.prototype,a.Events),d=function(b){function d(){return f=d.__super__.constructor.apply(this,arguments)}return h(d,b),d.generator=new c.IDGenerator,d.naiveSort=function(a,b,c){var d,e,f,g,h;for(e=function(){var b,e,f,g;for(f=a.toArray(),g=[],b=0,e=f.length;e>b;b++)d=f[b],g.push(d[c].detach());return g}(),h=[],f=0,g=e.length;g>f;f++)d=e[f],h.push(b.append(d));return h},d.prototype.initialize=function(a){var b=this;return this.key="_subview-"+d.generator.generate(),this.elementKey="element-"+this.key,this.prepend=null!=a.prepend?a.prepend:!1,this.generator=a.generator,this.renderedItems={},this.model.each(function(a){return b.initItem(a)}),this.model.bind("add",function(a){return b.addItem(a)}),this.model.bind("remove",function(a){return b.removeItem(a)}),this.model.bind("sort",function(){return d.naiveSort(b.model,b.$el,b.elementKey)}),this.model.bind("reset",function(a){var c,d,e;e=b.renderedItems;for(d in e)c=e[d],b.removeItem(c);return a.each(function(a){return b.addItem(a)})})},d.prototype.setElement=function(a){this.$el=a},d.prototype.addItem=function(a){return this.initItem(a),this.renderItem(a)},d.prototype.removeItem=function(b){return null!=b[this.key]?(b[this.key]instanceof a.View?b[this.key].remove():b[this.elementKey].remove(),delete this.renderedItems[b.cid]):void 0},d.prototype.initItem=function(a){return a[this.key]=this.generator(a)},d.prototype.renderItem=function(b){if(b[this.key]instanceof c.Template)b[this.elementKey]=b[this.key].render(b);else{if(!(b[this.key]instanceof a.View))throw new Error("Generator must return either a Gunther.Template or a Backbone.View instance");b[this.key].render(),b[this.elementKey]=b[this.key].el}return this.prepend?this.$el.prepend(b[this.elementKey]):this.$el.append(b[this.elementKey]),this.renderedItems[b.cid]=b},d.prototype.render=function(){var a=this;return this.model.each(function(b){return a.renderItem(b)})},d}(a.View),c.Template=function(){function f(a){this.fn=a}return f.domParsers=[],f.createHtmlElement=function(a){var b,c,d,f,g,h;return h=a.match(/([a-z]+)([\.|\#]?)/i)[1],d=$(document.createElement(h)),h===a?d:(f=a.match(/\#(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)+/i),null!=f&&d.attr("id",f[0].substring(1)),c=a.match(/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gi),g=function(a,b){return a+" "+b.substring(1)},b=$.trim(e.reduce(c,g,"")),d.attr("class",b),d)},f.elementValue=function(a,b){return null==b&&(b={}),"function"==typeof a?a.apply(b):a},f.generateChildren=function(d,e,f){var g;return g=c.Template.elementValue(e,f),void 0!==g?("object"!=typeof g&&d.append(document.createTextNode(g)),g instanceof b?(g.getValueInEl(d),g.bind("change",function(){return d.empty(),g.getValueInEl(d)})):g instanceof a.View?(g.setElement(d),g.render()):void 0):void 0},f.prototype.render=function(){var a,b,d,e,f,g,h,j,k;for(a=1<=arguments.length?i.call(arguments,0):[],this.root=$("<div />"),this.current=this.root,this.fn.apply(this,a),d=this.root.children(),k=c.Template.domParsers,f=0,h=k.length;h>f;f++)for(e=k[f],g=0,j=d.length;j>g;g++)b=d[g],e(b);return d},f.prototype.renderInto=function(){var b,c,d,e,f,g;for(d=arguments[0],b=2<=arguments.length?i.call(arguments,1):[],g=this.render.apply(this,b),e=0,f=g.length;f>e;e++)c=g[e],$(d).append(c);return new a.View({el:$(d)})},f.prototype.text=function(a){var d,e;return e=document.createTextNode(""),"string"==typeof a?e.nodeValue=a:(d=c.Template.elementValue(a,this),d instanceof b&&(e.nodeValue=d.getValue(),d.bind("change",function(a){return e.nodeValue=a}))),this.current.append(e)},f.prototype.element=function(){var a,d,e,f,g;return g=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],d=this.current,e=c.Template.createHtmlElement(g),this.current=e,f=a[a.length-1],"function"==typeof f?c.Template.generateChildren(e,a.pop(),this):f instanceof b?c.Template.generateChildren(e,a.pop(),this):"string"==typeof f&&e.append(document.createTextNode(a.pop())),d.append(e),this.current=d,null},f.prototype.attribute=function(){var a,c,d,e;return d=arguments[0],e=arguments[1],a=3<=arguments.length?i.call(arguments,2):[],c=this.current,e instanceof b?(c.attr(d,e.getValue()),e.bind("change",function(){return c.attr(d,e)})):c.attr(d,e)},f.prototype.on=function(a,b){return this.current.bind(a,b)},f.prototype.append=function(b){return b instanceof a.View?(b.render(),this.current.append(b.el)):this.current.append(b)},f.prototype.subTemplate=function(){var a,b;return b=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],b.renderInto.apply(b,[this.current].concat(i.call(a)))},f.prototype.bind=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,a,function(){})},f.prototype.itemSubView=function(a){return new d(a)},f.prototype.e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],this.element.apply(this,[b].concat(i.call(a)))},f.prototype.t=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],this.text.apply(this,a)},f.prototype.a=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],this.attribute.apply(this,a)},f.prototype.attr=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],this.attribute.apply(this,a)},f}()}.call(this);