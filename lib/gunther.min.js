/*! gunther 2014-02-26 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=[].slice,q={}.hasOwnProperty,r=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};if(d={},"undefined"!=typeof require&&null!==require?(module.exports=d,i=require("underscore"),a=require("backbone")):(window.Gunther=d,i=window._,a=window.Backbone),typeof i===!1)throw new Error("Underscore.js must be loaded for Gunther to work");for(d.Helper=function(){function a(){}return a.createHtmlElement=function(a){var b,c,d,e,f,g,h,j;if(g=i.filter(a.split(/(?=\.)|(\[.+\=.+\])|(\:[a-z0-9]+)|(?=#)/),function(a){return null!=a}),!(g.length>=1))throw new Error("Invalid element description "+a);if(e=g[0],!/^[a-zA-Z0-9]+$/.test(e))throw new Error("Invalid tag name "+e);if(c=$(document.createElement(e)),e===a)return c;for(h=0,j=g.length;j>h;h++)if(f=g[h],"#"===f[0])c.attr("id",f.substr(1));else if("."===f[0])d=null!=c.attr("class")?c.attr("class")+" ":"",c.attr("class",d+f.substr(1));else if(":"===f[0])c.prop(f.substr(1),!0);else if("["===f[0]&&(f[f.length=1]="]")){if(b=f.substr(1).substr(0,f.length-2).split("="),2!==b.length)continue;c.attr(b[0],b[1])}return c},a.animationFrame=function(a){return this._requestAnimationFrame.call(window,a)},a._requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(function(){return a(+new Date)},17)},a}(),d.IDGenerator=function(){function a(){this.value=0}return a.prototype.generate=function(){return this.value++},a}(),c=function(){function b(a,b,c){var d,e,f,g,h=this;for(this.model=a,this.propertyNames=b,this.valueGenerator=c,null==this.valueGenerator&&"string"==typeof this.propertyNames&&(this.valueGenerator=function(){return h.model.get(h.propertyNames[0])}),this.propertyNames=[].concat(this.propertyNames),g=this.propertyNames,e=0,f=g.length;f>e;e++)d=g[e],this.model.bind("change:"+d,function(){return h.trigger("change",h.getValue())})}return b.prototype.getValue=function(){var a;return a=this.valueGenerator(),a instanceof d.Template?a.render():a},b.prototype.getValueInEl=function(b){var c,e,f,g,h;if(e=this.valueGenerator(),e instanceof d.Template)return e.renderInto(b,this.model);if(e instanceof a.View)return e.setElement(b),e.render();if(b.length>0){for(h=[],f=0,g=b.length;g>f;f++)c=b[f],h.push(c.textContent=e);return h}return b.textContent=e},b}(),i.extend(c.prototype,a.Events),b=function(){function a(){var a,b,c,e=this;a=arguments[0],b=arguments[1],c=3<=arguments.length?p.call(arguments,2):[],this.model=a,this.propertyName=b,this.template=c.pop(),this.args=c,"function"!=typeof this.template||this.template instanceof d.Template||(this.template=new d.Template(this.template)),this.currentValue=this.model.get(this.propertyName),this.model.bind("change:"+this.propertyName,function(a){var b;return b=a.get(e.propertyName),b!==e.currentValue?(e.currentValue=b,e.trigger("change",b)):void 0})}return a.prototype.getValueInEl=function(a){return this.template.renderInto.apply(this.template,[].concat(a,this.model.get(this.propertyName),this.args))},a}(),i.extend(b.prototype,a.Events),d.Template=function(){function e(a){this.fn=a}return e.domParsers=[],e.elementValue=function(a,b){return null==b&&(b={}),"function"==typeof a?a.apply(b):a},e.generateChildren=function(e,f,g){var h;return h=d.Template.elementValue(f,g),void 0!==h?("object"!=typeof h&&e.append(document.createTextNode(h)),h instanceof c||h instanceof b?(h.getValueInEl(e),h.bind("change",function(){return e.empty(),h.getValueInEl(e)})):h instanceof d.SwitchedView?h.render():h instanceof a.View?(h.setElement(e),h.render()):void 0):void 0},e.prototype.render=function(){var a,b,c,e,f,g,h,i,j;for(a=1<=arguments.length?p.call(arguments,0):[],this.root=$("<div />"),this.current=this.root,this.fn.apply(this,a),c=this.root.contents(),j=d.Template.domParsers,f=0,h=j.length;h>f;f++)for(e=j[f],g=0,i=c.length;i>g;g++)b=c[g],e(b);return c},e.prototype.renderInto=function(){var a,b,c,d,e,f;for(d=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],c=this.render.apply(this,a),e=0,f=c.length;f>e;e++)b=c[e],$(d).append(b);return c},e.prototype.subTemplate=function(){var a,b;return b=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],b.renderInto.apply(b,[this.current].concat(p.call(a)))},e.prototype.bind=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){})},e.prototype.onModel=function(a,b,c){var d;return d=this.current,a.on(b,function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],c.apply(this,[d].concat(a))})},e.prototype.e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],this.element.apply(this,[b].concat(p.call(a)))},e.prototype.t=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.text.apply(this,a)},e.prototype.attr=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.attribute.apply(this,a)},e.prototype.prop=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.property.apply(this,a)},e.prototype["class"]=function(a){return this.attribute("class",a)},e}(),d.Template.prototype.on=function(a,b){return this.current.bind(a,b)},d.Template.prototype.haltedOn=function(a,b){return this.current.bind(a,function(a){return a.stopPropagation(),a.preventDefault(),b(a)})},d.Template.prototype.show=function(a,b,c){var d,e,f,g,h,i,j;for(d=this.current,null==c&&(c=function(a){return a}),f=function(a,b){return b?$(a).show():$(a).hide()},i=[].concat(b),j=[],g=0,h=i.length;h>g;g++)e=i[g],j.push(function(b){return a.on("change:"+b,function(a){return f(d,c(a.get(b)))}),f(d,c(a.get(b)))}(e));return j},d.Template.prototype.hide=function(a,b,c){return null==c&&(c=function(a){return a}),this.show(a,b,function(a){return!c(a)})},d.Template.prototype.element=function(){var a,e,f,g,h;return h=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],e=this.current,f=d.Helper.createHtmlElement(h),this.current=f,g=a[a.length-1],"function"==typeof g?d.Template.generateChildren(f,a.pop(),this):g instanceof c||g instanceof b?d.Template.generateChildren(f,a.pop(),this):"string"==typeof g&&f.append(document.createTextNode(a.pop())),e.append(f),this.current=e,null},d.Template.prototype.boundElement=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.element(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,a,function(){}))},d.Template.prototype.append=function(b){return b instanceof a.View?(b.render(),this.current.append(b.el)):this.current.append(b)},d.Template.prototype.itemSubView=function(a,b){return null==b&&(b=null),new e(a,b)},d.Template.prototype.asyncList=function(b,c,d){var f;return null==d&&(d=null),c instanceof a.Collection&&(f=c,c={model:f,generator:d}),c.sync=!1,this.element(b,function(){return new e(c)})},d.Template.prototype.syncList=function(b,c,d){var f;return null==d&&(d=null),c instanceof a.Collection&&(f=c,c={model:f,generator:d}),c.sync=!0,this.element(b,function(){return new e(c)})},d.Template.prototype.list=d.Template.prototype.syncList,e=function(b){function c(){return m=c.__super__.constructor.apply(this,arguments)}return r(c,b),c.remove=function(a){return $(a).remove()},c.defaultEvents={preRemove:function(){return null},postRemove:function(){return null},preInsert:function(){return null},postInsert:function(){return null}},c.generator=new d.IDGenerator,c.naiveSort=function(a,b,c){var d,e,f,g,h;for(e=function(){var b,e,f,g;for(f=a.toArray(),g=[],b=0,e=f.length;e>b;b++)d=f[b],g.push(d[c].detach());return g}(),h=[],f=0,g=e.length;g>f;f++)d=e[f],h.push(b.appendChild(d));return h},c.prototype.initialize=function(b,d){return b instanceof a.Collection&&(this.model=b,b={model:b,generator:d}),this.key="_subview-"+c.generator.generate(),this.elementKey="element-"+this.key,this.renderedItems={},this._parseOptions(b),this._initEvents()},c.prototype.setElement=function(a){this.$el=a},c.prototype.render=function(){var a=this;return this.model.each(function(b){return a._initItem(b)}),this.model.each(function(b){return a._renderItem(b)})},c.prototype._parseOptions=function(a){if(this.prepend=null!=a.prepend?a.prepend:!1,this.generator="function"==typeof a.generator?new d.Template(a.generator):a.generator,!(this.generator instanceof d.Template))throw new Error("No generator passed");return this.events=i.extend(c.defaultEvents,null!=a.events?a.events:{}),this.remove=null!=a.remove?a.remove:c.remove,this.evenClass=null!=a.evenClass?a.evenClass:void 0,this.oddClass=null!=a.oddClass?a.oddClass:void 0,this.sync=null!=a.sync?a.sync:!1,this.model=null!=a.collection?a.collection:this.model},c.prototype._initEvents=function(){var a=this;return this._addItems=[],this._removeItems=[],this._checkingQueue=!1,this.model.bind("add",function(b){return a._addItemToAddQueue(b)}),this.model.bind("remove",function(b){return a._addItemToRemoveQueue(b)}),this.model.bind("sort",function(){return c.naiveSort(a.model,a.$el,a.elementKey)}),this.model.bind("reset",function(b){var c,d,e;e=a.renderedItems;for(d in e)c=e[d],a.removeItem(c);return b.each(function(b){return a.addItem(b)})})},c.prototype._renderItem=function(b){if(b[this.key]instanceof d.Template)b[this.elementKey]=b[this.key].render(b);else{if(!(b[this.key]instanceof a.View))throw new Error("Generator must return either a Gunther.Template or a Backbone.View instance");b[this.key].render(),b[this.elementKey]=b[this.key].el}return this.events.preInsert(b[this.elementKey],this.$el),null!=this.evenClass&&this.model.indexOf(b)%2===0?$(b[this.elementKey]).addClass(this.evenClass):null!=this.oddClass&&$(b[this.elementKey]).addClass(this.oddClass),this.prepend?this.$el.prependChild(b[this.elementKey]):$(this.$el).append(b[this.elementKey]),this.events.postInsert(b[this.elementKey],this.$el),this.renderedItems[b.cid]=b},c.prototype._removeItem=function(b){return b[this.key]instanceof a.View?(this.events.preRemove(b[this.key]),b[this.key].remove(),this.events.postRemove()):(this.events.preRemove(b[this.elementKey]),this.remove(b[this.elementKey]),this.events.postRemove(),delete b[this.elementKey]),delete this.renderedItems[b.cid]},c.prototype._initItem=function(a){return a[this.key]="function"==typeof this.generator?this.generator(a):this.generator},c.prototype._addItemToAddQueue=function(a){return this._initItem(a),this._addItems.push(a),this._addQueueCheck()},c.prototype._addItemToRemoveQueue=function(a){return null!=a[this.key]?(this._removeItems.push(a),this._addQueueCheck()):void 0},c.prototype._addQueueCheck=function(){var a=this;return this.sync?this._checkQueue():d.Helper.animationFrame(function(){return a._checkQueue()})},c.prototype._checkQueue=function(){var a,b,c,d,e,f,g,h;if(!this._checkingQueue){for(this._checkingQueue=!0,g=this._addItems,c=0,e=g.length;e>c;c++)b=g[c],this._renderItem.apply(this,[b]);for(h=this._removeItems,a=d=0,f=h.length;f>d;a=++d)b=h[a],this._removeItem(b);return this._addItems=[],this._removeItems=[],this._checkingQueue=!1}},c}(a.View),d.partials={},d.addPartial=function(a,b){if(d.partials[a]=b,null!=d.Template.prototype[a])throw new Error('Can not add partial "'+a+'", a partial or method with that name already exists');return d.Template.prototype[a]=function(){var b;return b=1<=arguments.length?p.call(arguments,0):[],this.partial.apply(this,[a].concat(b))}},d.removePartial=function(){return delete d.partials.key},d.Template.prototype.partial=function(){var a,b,c;if(b=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],null==d.partials[b])throw new Error('Partial "'+b+'" does not exist');return c=new d.Template(d.partials[b]),this.subTemplate.apply(this,[c].concat(a))},d.Template.prototype.attribute=function(a,b){var d;return d=this.current,b instanceof c?(d.attr(a,b.getValue()),b.bind("change",function(){return d.attr(a,b.getValue())})):d.attr(a,b),null},d.Template.prototype.boundAttribute=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.attribute(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},d.Template.prototype.property=function(a,b){var d;return d=this.current,b instanceof c?(d.prop(a,b.getValue()),b.bind("change",function(){return d.prop(a,b.getValue())})):d.prop(a,b),null},d.Template.prototype.boundProperty=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.property(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},d.Template.prototype.css=function(a,b){var d,e;return a instanceof Object?function(){var c;c=[];for(e in a)b=a[e],c.push(this.css(e,b));return c}.call(this):(d=this.current,b instanceof c?(d.css(a,b.getValue()),b.bind("change",function(b){return d.css(a,b)}),d):(d.css(a,b),null))},d.Template.prototype.boundCss=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.css(a.shift(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},d.Template.prototype.toggleClass=function(a,b,c,d){var e,f,g,h,i;for(g=[].concat(c),d instanceof Function||(d=function(a){return a}),e=this.current,f=function(b,c){return $(e).toggleClass(a,d(c))},h=0,i=g.length;i>h;h++)c=g[h],b.on("change:"+c,f),f(b,b.get(c));return null},d.Template.prototype.switchView=function(a,b,c,d){return this.element(a,function(){return new f(this.current,b,c,d)})},f=function(){function a(a,b,c,d){var e=this;this.parent=a,this.model=b,this.attributeName=c,this.model.on("change:"+this.attributeName,function(){return e.render()}),d.apply(this,[this.model])}return a.prototype.switches=[],a.prototype.render=function(){var a=this;return null!=this.active&&this.active.makeUnActiveIn(this.parent),this.active=i.find(this.switches,function(b){return b.isActive(a.model.get(a.attributeName))}),this.active.makeActiveIn(this.parent)},a.prototype.keep=function(){var a,b;return b=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],this.switches.push(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(g,[g.KEEP,b].concat(p.call(a)),function(){}))},a.prototype["switch"]=function(){var a,b;return b=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],this.switches.push(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(g,[g.SWITCH,b].concat(p.call(a)),function(){}))},a}(),g=function(){function a(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?p.call(arguments,2):[],this.type=c,this.template=b,this.determinator=a.pop(),this.arguments=a}return a.KEEP="keep",a.SWITCH="switch",a.prototype.isActive=!1,a.prototype.isActive=function(a){return this.determinator(a)},a.prototype.makeActiveIn=function(a){return null!=this.switchedElements?this.switchedElements.show():this.switchedElements=this.template.renderInto.apply(this.template,[a].concat(this.arguments))},a.prototype.makeUnActiveIn=function(){return this.type===a.KEEP?this.switchedElements.hide():(this.switchedElements.remove(),this.switchedElements=null)},a}(),d.SwitchedView=f,d.Template.prototype.text=function(a){var b,e;return e=document.createTextNode(""),"string"==typeof a?e.nodeValue=a:(b=d.Template.elementValue(a,this),b instanceof c?(e.nodeValue=b.getValue(),b.bind("change",function(a){return e.nodeValue=a})):e.nodeValue=b),this.current.append(e)},d.Template.prototype.boundText=function(){var a;return a=1<=arguments.length?p.call(arguments,0):[],this.text(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){}))},d.Template.prototype.spacedText=function(a){return this.text(" "+a+" ")},d.View=function(a){function b(){return n=b.__super__.constructor.apply(this,arguments)}return r(b,a),b.wrapTemplate=function(a){return"function"==typeof a?new d.Template(a):a},b.prototype.render=function(){var a;if(a=d.View.wrapTemplate(this.template),!(a instanceof d.Template))throw new Error("No template given");return a.renderInto(this.$el)},b}(a.View),d.html5Tags=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datagrid","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","eventsource","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","mark","map","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","ruby","rp","rt","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],o=d.html5Tags,j=function(a){return d.addPartial(a,function(){var b;return b=1<=arguments.length?p.call(arguments,0):[],this.element.apply(this,[a].concat(b))})},k=0,l=o.length;l>k;k++)h=o[k],j(h)}).call(this);