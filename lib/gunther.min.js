/*! gunther 2013-10-29 */
!function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j=[].slice;if(d={partials:{},addPartial:function(a,b){return d.partials[a]=b}},"undefined"!=typeof require&&null!==require?(module.exports=d,f=require("underscore"),a=require("backbone")):(window.Gunther=d,f=window._,a=window.Backbone),typeof f===!1)throw"Underscore.js must be loaded for Gunther to work";d.Helper=function(){function a(){}return a.createHtmlElement=function(a){var b,c,d,e,g,h;return h=a.match(/([a-z0-9]+)([\.|\#]?)/i)[1],d=$(document.createElement(h)),h===a?d:(e=a.match(/\#(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)+/i),null!=e&&d.attr("id",e[0].substring(1)),c=a.match(/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gi),g=function(a,b){return a+" "+b.substring(1)},b=$.trim(f.reduce(c,g,"")),d.attr("class",b),d)},a}(),d.IDGenerator=function(){function a(){this.value=0}return a.prototype.generate=function(){return this.value++},a}(),c=function(){function b(a,b,c){var d,e,f,g,h=this;for(this.model=a,this.propertyNames=b,this.valueGenerator=c,null==this.valueGenerator&&"string"==typeof this.propertyNames&&(this.valueGenerator=function(){return h.model.get(h.propertyNames[0])}),this.propertyNames=[].concat(this.propertyNames),g=this.propertyNames,e=0,f=g.length;f>e;e++)d=g[e],this.model.bind("change:"+d,function(){return h.trigger("change",h.getValue())})}return b.prototype.getValue=function(){var a;return a=this.valueGenerator(),a instanceof d.Template?a.render():a},b.prototype.getValueInEl=function(b){var c,e,f,g,h;if(e=this.valueGenerator(),e instanceof d.Template)return e.renderInto(b,this.model);if(e instanceof a.View)return e.setElement(b),e.render();if(b.length>0){for(h=[],f=0,g=b.length;g>f;f++)c=b[f],h.push(c.textContent=e);return h}return b.textContent=e},b}(),f.extend(c.prototype,a.Events),b=function(){function a(a,b,c){var d=this;this.model=a,this.propertyName=b,this.template=c,this.currentCid=this.model.cid,this.model.bind("change:"+this.propertyName,function(b){return a=b.get(d.propertyName),null==a||a.cid!==d.currentCid?(d.currentCid=null!=a?a.cid:null,d.trigger("change",a)):void 0})}return a.prototype.getValueInEl=function(a){return this.template.renderInto(a,this.model.get(this.propertyName))},a}(),f.extend(b.prototype,a.Events),e=function(b){function c(){return g=c.__super__.constructor.apply(this,arguments)}return i(c,b),c.remove=function(a){return $(a).remove()},c.defaultEvents={preRemove:function(){return null},postRemove:function(){return null},preInsert:function(){return null},postInsert:function(){return null}},c.generator=new d.IDGenerator,c.naiveSort=function(a,b,c){var d,e,f,g,h;for(e=function(){var b,e,f,g;for(f=a.toArray(),g=[],b=0,e=f.length;e>b;b++)d=f[b],g.push(d[c].detach());return g}(),h=[],f=0,g=e.length;g>f;f++)d=e[f],h.push(b.append(d));return h},c.prototype.initialize=function(a){var b=this;return this.key="_subview-"+c.generator.generate(),this.elementKey="element-"+this.key,this.prepend=null!=a.prepend?a.prepend:!1,this.generator=a.generator,this.events=f.extend(c.defaultEvents,null!=a.events?a.events:{}),this.remove=null!=a.remove?a.remove:c.remove,this.renderedItems={},this.model.each(function(a){return b.initItem(a)}),this.model.bind("add",function(a){return b.addItem(a)}),this.model.bind("remove",function(a){return b.removeItem(a)}),this.model.bind("sort",function(){return c.naiveSort(b.model,b.$el,b.elementKey)}),this.model.bind("reset",function(a){var c,d,e;e=b.renderedItems;for(d in e)c=e[d],b.removeItem(c);return a.each(function(a){return b.addItem(a)})})},c.prototype.setElement=function(a){this.$el=a},c.prototype.addItem=function(a){return this.initItem(a),this.renderItem(a)},c.prototype.removeItem=function(b){return null!=b[this.key]?(b[this.key]instanceof a.View?(this.events.preRemove(b[this.key]),b[this.key].remove(),this.events.postRemove()):(this.events.preRemove(b[this.elementKey]),this.remove(b[this.elementKey]),this.events.postRemove()),delete this.renderedItems[b.cid]):void 0},c.prototype.initItem=function(a){return a[this.key]=this.generator(a)},c.prototype.renderItem=function(b){if(b[this.key]instanceof d.Template)b[this.elementKey]=b[this.key].render(b);else{if(!(b[this.key]instanceof a.View))throw new Error("Generator must return either a Gunther.Template or a Backbone.View instance");b[this.key].render(),b[this.elementKey]=b[this.key].el}return this.events.preInsert(b[this.elementKey],this.$el),this.prepend?this.$el.prepend(b[this.elementKey]):this.$el.append(b[this.elementKey]),this.events.postInsert(b[this.elementKey],this.$el),this.renderedItems[b.cid]=b},c.prototype.render=function(){var a=this;return this.model.each(function(b){return a.renderItem(b)})},c}(a.View),d.Template=function(){function f(a){this.fn=a}return f.domParsers=[],f.removePartial=function(){return delete d.Template.partials.key},f.elementValue=function(a,b){return null==b&&(b={}),"function"==typeof a?a.apply(b):a},f.generateChildren=function(e,f,g){var h;return h=d.Template.elementValue(f,g),void 0!==h?("object"!=typeof h&&e.append(document.createTextNode(h)),h instanceof c||h instanceof b?(h.getValueInEl(e),h.bind("change",function(){return e.empty(),h.getValueInEl(e)})):h instanceof a.View?(h.setElement(e),h.render()):void 0):void 0},f.prototype.render=function(){var a,b,c,e,f,g,h,i,k;for(a=1<=arguments.length?j.call(arguments,0):[],this.root=$("<div />"),this.current=this.root,this.fn.apply(this,a),c=this.root.children(),k=d.Template.domParsers,f=0,h=k.length;h>f;f++)for(e=k[f],g=0,i=c.length;i>g;g++)b=c[g],e(b);return c},f.prototype.renderInto=function(){var b,c,d,e,f,g;for(d=arguments[0],b=2<=arguments.length?j.call(arguments,1):[],g=this.render.apply(this,b),e=0,f=g.length;f>e;e++)c=g[e],$(d).append(c);return new a.View({el:$(d)})},f.prototype.text=function(a){var b,e;return e=document.createTextNode(""),"string"==typeof a?e.nodeValue=a:(b=d.Template.elementValue(a,this),b instanceof c?(e.nodeValue=b.getValue(),b.bind("change",function(a){return e.nodeValue=a})):e.nodeValue=b),this.current.append(e)},f.prototype.element=function(){var a,e,f,g,h;return h=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],e=this.current,f=d.Helper.createHtmlElement(h),this.current=f,g=a[a.length-1],"function"==typeof g?d.Template.generateChildren(f,a.pop(),this):g instanceof c||g instanceof b?d.Template.generateChildren(f,a.pop(),this):"string"==typeof g&&f.append(document.createTextNode(a.pop())),e.append(f),this.current=e,null},f.prototype.attribute=function(){var a,b,d,e;return d=arguments[0],e=arguments[1],a=3<=arguments.length?j.call(arguments,2):[],b=this.current,e instanceof c?(b.attr(d,e.getValue()),e.bind("change",function(){return b.attr(d,e.getValue())})):b.attr(d,e)},f.prototype.property=function(){var a,b,d,e;return d=arguments[0],e=arguments[1],a=3<=arguments.length?j.call(arguments,2):[],b=this.current,e instanceof c?(b.prop(d,e.getValue()),e.bind("change",function(){return b.prop(d,e.getValue())})):b.prop(d,e)},f.prototype.css=function(a,b){var d,e;return a instanceof Object?function(){var c;c=[];for(e in a)b=a[e],c.push(this.css(e,b));return c}.call(this):(d=this.current,b instanceof c?(d.css(a,b.getValue()),b.bind("change",function(b){return d.css(a,b)}),d):d.css(a,b))},f.prototype.toggleClass=function(a,b,c,d){var e,f,g,h,i,j;for(c=[].concat(c),d instanceof Function||(d=function(a){return a}),e=this.current,f=function(b,c){return $(e).toggleClass(a,d(c))},j=[],h=0,i=c.length;i>h;h++)g=c[h],b.on("change:"+g,f),j.push(f(b,b.get(g)));return j},f.prototype.on=function(a,b){return this.current.bind(a,b)},f.prototype.onModel=function(a,b,c){var d;return d=this.current,a.on(b,function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],c.apply(this,[d].concat(a))})},f.prototype.append=function(b){return b instanceof a.View?(b.render(),this.current.append(b.el)):this.current.append(b)},f.prototype.subTemplate=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],b.renderInto.apply(b,[this.current].concat(j.call(a)))},f.prototype.partial=function(){var a,b,c;if(b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],null==d.partials[b])throw new Error('Partial "'+b+'" does not exist');return c=new d.Template(d.partials[b]),this.subTemplate.apply(this,[c].concat(a))},f.prototype.bind=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(c,a,function(){})},f.prototype.bindModel=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,a,function(){})},f.prototype.itemSubView=function(a){return new e(a)},f.prototype.e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],this.element.apply(this,[b].concat(j.call(a)))},f.prototype.t=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.text.apply(this,a)},f.prototype.a=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.attribute.apply(this,a)},f.prototype.attr=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.attribute.apply(this,a)},f.prototype.prop=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.property.apply(this,a)},f.prototype["class"]=function(a){return this.attribute("class",a)},f.prototype.p=function(){var a;return a=1<=arguments.length?j.call(arguments,0):[],this.partial.apply(this,a)},f}()}.call(this);