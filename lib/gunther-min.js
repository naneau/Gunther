((function(){var a,b,c,d,e,f,g,h,i,j,k=Object.prototype.hasOwnProperty,l=function(a,b){function d(){this.constructor=a}for(var c in b)k.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},m=Array.prototype.slice;c={},typeof require!=null?(module.exports=c,f=require("underscore"),a=require("backbone")):window.Gunther=c;if(typeof f===!1)throw"Underscore.js must be loaded for Gunther to work";c.IDGenerator=function(){function a(){this.value=0}return a.prototype.generate=function(){return this.value++},a}(),c.HTML=function(){function a(){}return a.elements=["a","abbr","address","article","aside","audio","b","bdi","bdo","blockquote","body","button","canvas","caption","cite","code","colgroup","datalist","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","i","iframe","ins","kbd","label","legend","li","map","mark","menu","meter","nav","noscript","object","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","u","ul","video","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","applet","acronym","bgsound","dir","frameset","noframes","isindex","listing","nextid","noembed","plaintext","rb","strike","xmp","big","blink","center","font","marquee","multicol","nobr","spacer","tt","basefont","frame","date"],a.eventNames=["load","unload","blur","change","focus","reset","select","submit","abort","keydown","keyup","keypress","click","dblclick","mousedown","mouseout","mouseover","mouseup"],a}(),b=function(){function a(a,b,c){var d,e,f,g,h=this;this.model=a,this.propertyNames=b,this.valueGenerator=c,this.valueGenerator==null&&typeof this.propertyNames=="string"&&(this.valueGenerator=function(){return h.model.get(h.propertyNames[0])}),this.propertyNames=[].concat(this.propertyNames),g=this.propertyNames;for(e=0,f=g.length;e<f;e++)d=g[e],this.model.bind("change:"+d,function(){return h.trigger("change",h.getValue())})}return a.prototype.getValue=function(){var a;return a=this.valueGenerator(),a instanceof c.Template?a.render():a},a}(),f.extend(b.prototype,a.Events),d=function(b){function d(){d.__super__.constructor.apply(this,arguments)}return l(d,b),d.generator=new c.IDGenerator,d.prototype.initialize=function(b){var c=this;return this.key="_subview-"+d.generator.generate(),this.elementKey="element-"+this.key,this.prepend=b.prepend!=null?b.prepend:!1,this.generator=b.generator,this.model.each(function(a){return c.initItem(a)}),this.model.bind("add",function(a){return c.initItem(a),c.renderItem(a)}),this.model.bind("remove",function(b){if(b[c.key]==null)return;return b[c.key]instanceof a.View?b[c.key].remove():b[c.elementKey].remove()})},d.prototype.initItem=function(a){return a[this.key]=this.generator(a)},d.prototype.renderItem=function(b){if(b[this.key]instanceof c.Template)b[this.elementKey]=b[this.key].render(b);else{if(!(b[this.key]instanceof a.View))throw new Error("Generator must return either a Gunther.Template or a Backbone.View instance");b[this.key].render(),b[this.elementKey]=b[this.key].el}return this.prepend?this.el.prepend(b[this.elementKey]):this.el.append(b[this.elementKey])},d.prototype.render=function(){var a=this;return this.model.each(function(b){return a.renderItem(b)})},d}(a.View),c.Template=function(){function e(a){this.fn=a,null}return e.domParsers=[],e.createHtmlElement=function(a){return $(document.createElement(a))},e.addAttributes=function(a,d){var e,g,h,i,j,k;k=[];for(i=0,j=d.length;i<j;i++)e=d[i],k.push(function(){var d;d=[];for(g in e)h=e[g],d.push(function(d,e){return f.include(c.HTML.eventNames,d)?a.bind(d,function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],e.apply(null,a)}):e instanceof b?(a.attr(d,e.getValue()),e.bind("change",function(b){return a.attr(d,b)})):a.attr(d,e)}(g,h));return d}());return k},e.generateChildren=function(c,d,e){var f;f=d.apply(e),typeof f!="object"&&c.append(document.createTextNode(f));if(f instanceof b)return c.html(f.getValue()),f.bind("change",function(a){return c.html(a)});if(f instanceof a.View)return f.el=c,f.render()},e.prototype.render=function(){var a,b,d,e,f,g,h,i,j;a=1<=arguments.length?m.call(arguments,0):[],this.root=$("<div />"),this.current=this.root,this.fn.apply(this,a),d=this.root.children(),j=c.Template.domParsers;for(f=0,h=j.length;f<h;f++){e=j[f];for(g=0,i=d.length;g<i;g++)b=d[g],e(b)}return d},e.prototype.renderInto=function(){var b,c,d,e,f,g;d=arguments[0],b=2<=arguments.length?m.call(arguments,1):[],g=this.render.apply(this,b);for(e=0,f=g.length;e<f;e++)c=g[e],d.append(c);return new a.View({el:d})},e.prototype.text=function(a){var c,d;return d=document.createTextNode(""),typeof a=="string"?d.nodeValue=a:(typeof a=="function"&&(c=a.apply(this)),c instanceof b&&(d.nodeValue=c.getValue(),c.bind("change",function(a){return d.nodeValue=a}))),this.current.append(d)},e.prototype.addElement=function(){var a,b,d,e;return e=arguments[0],a=2<=arguments.length?m.call(arguments,1):[],b=this.current,d=c.Template.createHtmlElement(e),this.current=d,typeof a[a.length-1]=="function"&&c.Template.generateChildren(d,a.pop(),this),c.Template.addAttributes(d,a),b.append(d),this.current=b,null},e.prototype.bind=function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(b,a,function(){})},e.prototype.itemSubView=function(a){return new d(a)},e.prototype.e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?m.call(arguments,1):[],this.addElement.apply(this,[b].concat(m.call(a)))},e.prototype.t=function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],this.text.apply(this,a)},e}(),j=c.HTML.elements,g=function(a){return c.Template.prototype[a]=function(){var b;return b=1<=arguments.length?m.call(arguments,0):[],this.addElement.apply(this,[a].concat(m.call(b)))}};for(h=0,i=j.length;h<i;h++)e=j[h],g(e)})).call(this);