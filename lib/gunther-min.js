((function(){var a,b,c,d,e,f=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},h=Array.prototype.slice;c={},typeof require!="undefined"&&require!==null?(module.exports=c,e=require("underscore"),a=require("backbone")):(window.Gunther=c,e=window._,a=window.Backbone);if(typeof e===!1)throw"Underscore.js must be loaded for Gunther to work";c.IDGenerator=function(){function a(){this.value=0}return a.prototype.generate=function(){return this.value++},a}(),b=function(){function b(a,b,c){var d,e,f,g,h=this;this.model=a,this.propertyNames=b,this.valueGenerator=c,this.valueGenerator==null&&typeof this.propertyNames=="string"&&(this.valueGenerator=function(){return h.model.get(h.propertyNames[0])}),this.propertyNames=[].concat(this.propertyNames),g=this.propertyNames;for(e=0,f=g.length;e<f;e++)d=g[e],this.model.bind("change:"+d,function(){return h.trigger("change",h.getValue())})}return b.prototype.getValue=function(){var a;return a=this.valueGenerator(),a instanceof c.Template?a.render():a},b.prototype.getValueInEl=function(b){var d,e,f,g,h;e=this.valueGenerator();if(e instanceof c.Template)return e.renderInto(b,this.model);if(e instanceof a.View)return e.setElement(b),e.render();if(b.length>0){h=[];for(f=0,g=b.length;f<g;f++)d=b[f],h.push(d.textContent=e);return h}return b.textContent=e},b}(),e.extend(b.prototype,a.Events),d=function(b){function d(){d.__super__.constructor.apply(this,arguments)}return g(d,b),d.generator=new c.IDGenerator,d.prototype.initialize=function(a){var b=this;return this.key="_subview-"+d.generator.generate(),this.elementKey="element-"+this.key,this.prepend=a.prepend!=null?a.prepend:!1,this.generator=a.generator,this.renderedItems={},this.model.each(function(a){return b.initItem(a)}),this.model.bind("add",function(a){return b.addItem(a)}),this.model.bind("remove",function(a){return b.removeItem(a)}),this.model.bind("reset",function(a){var c,d,e;e=b.renderedItems;for(d in e)c=e[d],b.removeItem(c);return a.each(function(a){return b.addItem(a)})})},d.prototype.setElement=function(a){this.$el=a},d.prototype.addItem=function(a){return this.initItem(a),this.renderItem(a)},d.prototype.removeItem=function(b){if(b[this.key]==null)return;return b[this.key]instanceof a.View?b[this.key].remove():b[this.elementKey].remove(),delete this.renderedItems[b.cid]},d.prototype.initItem=function(a){return a[this.key]=this.generator(a)},d.prototype.renderItem=function(b){if(b[this.key]instanceof c.Template)b[this.elementKey]=b[this.key].render(b);else{if(!(b[this.key]instanceof a.View))throw new Error("Generator must return either a Gunther.Template or a Backbone.View instance");b[this.key].render(),b[this.elementKey]=b[this.key].el}return this.prepend?this.$el.prepend(b[this.elementKey]):this.$el.append(b[this.elementKey]),this.renderedItems[b.cid]=b},d.prototype.render=function(){var a=this;return this.model.each(function(b){return a.renderItem(b)})},d}(a.View),c.Template=function(){function e(a){this.fn=a,null}return e.domParsers=[],e.createHtmlElement=function(a){return $(document.createElement(a))},e.elementValue=function(a,b){return b==null&&(b={}),typeof a=="function"?a.apply(b):a},e.generateChildren=function(d,e,f){var g;g=c.Template.elementValue(e,f);if(g===void 0)return;typeof g!="object"&&d.append(document.createTextNode(g));if(g instanceof b)return g.getValueInEl(d),g.bind("change",function(a){return d.empty(),g.getValueInEl(d)});if(g instanceof a.View)return g.setElement(d),g.render()},e.prototype.render=function(){var a,b,d,e,f,g,i,j,k;a=1<=arguments.length?h.call(arguments,0):[],this.root=$("<div />"),this.current=this.root,this.fn.apply(this,a),d=this.root.children(),k=c.Template.domParsers;for(f=0,i=k.length;f<i;f++){e=k[f];for(g=0,j=d.length;g<j;g++)b=d[g],e(b)}return d},e.prototype.renderInto=function(){var b,c,d,e,f,g;d=arguments[0],b=2<=arguments.length?h.call(arguments,1):[],g=this.render.apply(this,b);for(e=0,f=g.length;e<f;e++)c=g[e],$(d).append(c);return new a.View({el:$(d)})},e.prototype.text=function(a){var d,e;return e=document.createTextNode(""),typeof a=="string"?e.nodeValue=a:(d=c.Template.elementValue(a,this),d instanceof b&&(e.nodeValue=d.getValue(),d.bind("change",function(a){return e.nodeValue=a}))),this.current.append(e)},e.prototype.element=function(){var a,d,e,f,g;return g=arguments[0],a=2<=arguments.length?h.call(arguments,1):[],d=this.current,e=c.Template.createHtmlElement(g),this.current=e,f=a[a.length-1],typeof f=="function"?c.Template.generateChildren(e,a.pop(),this):f instanceof b?c.Template.generateChildren(e,a.pop(),this):typeof f=="string"&&e.append(document.createTextNode(a.pop())),d.append(e),this.current=d,null},e.prototype.attribute=function(){var a,c,d,e;return d=arguments[0],e=arguments[1],a=3<=arguments.length?h.call(arguments,2):[],c=this.current,e instanceof b?(c.attr(d,e.getValue()),e.bind("change",function(a){return c.attr(d,e)})):c.attr(d,e)},e.prototype.on=function(a,b){return this.current.bind(a,b)},e.prototype.append=function(b){return b instanceof a.View?(b.render(),this.current.append(b.el)):this.current.append(b)},e.prototype.subTemplate=function(){var a,b;return b=arguments[0],a=2<=arguments.length?h.call(arguments,1):[],b.renderInto.apply(b,[this.current].concat(h.call(a)))},e.prototype.bind=function(){var a;return a=1<=arguments.length?h.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(b,a,function(){})},e.prototype.itemSubView=function(a){return new d(a)},e.prototype.e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?h.call(arguments,1):[],this.element.apply(this,[b].concat(h.call(a)))},e.prototype.t=function(){var a;return a=1<=arguments.length?h.call(arguments,0):[],this.text.apply(this,a)},e.prototype.a=function(){var a;return a=1<=arguments.length?h.call(arguments,0):[],this.attribute.apply(this,a)},e.prototype.attr=function(){var a;return a=1<=arguments.length?h.call(arguments,0):[],this.attribute.apply(this,a)},e}()})).call(this);